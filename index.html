<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏´‡πâ‡∏≠‡∏á‡∏™‡∏°‡∏∏‡∏î‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</title>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- SweetAlert2 -->
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <!-- html5-qrcode -->
  <script src="https://unpkg.com/html5-qrcode"></script>
</head>
<body class="bg-slate-50 min-h-screen">
  <header class="grad p-6 text-white" style="background:linear-gradient(135deg,#10b981,#3b82f6,#8b5cf6);">
    <div class="max-w-5xl mx-auto flex items-center justify-between">
      <h1 class="text-2xl font-extrabold">üìö ‡∏£‡∏∞‡∏ö‡∏ö‡∏´‡πâ‡∏≠‡∏á‡∏™‡∏°‡∏∏‡∏î üìö</h1>
      <div class="text-sm opacity-90">‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏Ñ‡∏•‡∏≠‡∏á‡∏ó‡∏£‡∏á‡∏Å‡∏£‡∏∞‡πÄ‡∏ó‡∏µ‡∏¢‡∏°</div>
    </div>
  </header>

  <main class="max-w-5xl mx-auto p-6">
    <!-- Nav -->
    <nav class="bg-white p-3 rounded-2xl shadow flex gap-2 flex-wrap">
      <button class="tab-btn px-4 py-2 rounded-xl bg-emerald-100 text-emerald-900 font-semibold" data-tab="loan">‡∏¢‡∏∑‡∏°-‡∏Ñ‡∏∑‡∏ô</button>
      <button class="tab-btn px-4 py-2 rounded-xl bg-emerald-100 text-emerald-900 font-semibold" data-tab="add">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠</button>
      <button class="tab-btn px-4 py-2 rounded-xl bg-emerald-100 text-emerald-900 font-semibold" data-tab="gate">‡πÄ‡∏Ç‡πâ‡∏≤-‡∏≠‡∏≠‡∏Å</button>
      <button class="tab-btn px-4 py-2 rounded-xl bg-emerald-100 text-emerald-900 font-semibold" data-tab="assistant">‡∏ú‡∏π‡πâ‡∏ä‡πà‡∏ß‡∏¢</button>
      <button id="btnStats" class="ml-auto px-4 py-2 rounded-xl bg-slate-100">‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥</button>
    </nav>

    <!-- Loan (‡∏¢‡∏∑‡∏°-‡∏Ñ‡∏∑‡∏ô) -->
    <section id="loan" class="tab-panel bg-white rounded-2xl shadow p-6 mt-4">
      <div class="md:flex gap-6">
        <!-- Left: QR and manual code -->
        <div class="md:w-1/2 space-y-3">
          <h2 class="text-xl font-bold text-emerald-700">‡∏¢‡∏∑‡∏°-‡∏Ñ‡∏∑‡∏ô (‡∏™‡πÅ‡∏Å‡∏ô QR / ‡∏û‡∏¥‡∏°‡∏û‡πå‡∏£‡∏´‡∏±‡∏™)</h2>
          <p class="text-sm text-slate-500">‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÉ‡∏ä‡πâ‡∏Å‡∏•‡πâ‡∏≠‡∏á‡∏´‡∏•‡∏±‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô ‚Äî ‡∏´‡∏≤‡∏Å‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠‡∏Ç‡∏≠‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡∏Å‡∏•‡πâ‡∏≠‡∏á ‡πÉ‡∏´‡πâ‡∏Å‡∏î '‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï'</p>

          <div class="rounded-xl border p-3 bg-slate-50">
            <div id="qr-region" class="aspect-video rounded-lg overflow-hidden bg-black flex items-center justify-center"></div>
            <div class="flex gap-2 mt-3">
              <button id="btnStartQR" class="px-4 py-2 rounded-xl bg-emerald-600 text-white">‡πÄ‡∏õ‡∏¥‡∏î‡∏Å‡∏•‡πâ‡∏≠‡∏á</button>
              <button id="btnSwitchCam" class="px-4 py-2 rounded-xl bg-violet-600 text-white">‡∏™‡∏•‡∏±‡∏ö‡∏Å‡∏•‡πâ‡∏≠‡∏á</button>
              <button id="btnStopQR" class="px-4 py-2 rounded-xl bg-red-500 text-white">‡∏õ‡∏¥‡∏î‡∏Å‡∏•‡πâ‡∏≠‡∏á</button>
            </div>
            <div id="cameraList" class="text-xs text-slate-500 mt-2"></div>
          </div>

          <div class="rounded-xl border p-3 bg-white mt-3">
            <label class="text-sm">‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠ (‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏™‡πÅ‡∏Å‡∏ô)</label>
            <div class="flex gap-2 mt-2">
              <input id="manualCode" class="flex-1 px-3 py-2 border rounded-xl" placeholder="‡πÄ‡∏ä‡πà‡∏ô 0KT001" />
              <button id="btnLookupCode" class="px-4 py-2 bg-blue-600 text-white rounded-xl">‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</button>
            </div>
            <p class="text-xs text-slate-500 mt-2">‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å‡∏ä‡∏µ‡∏ï ‚Äú‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‚Äù ‡πÅ‡∏•‡∏∞‡πÄ‡∏ï‡∏¥‡∏°‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥</p>
          </div>
        </div>

        <!-- Right: Form -->
        <div class="md:w-1/2">
          <form id="loanForm" class="space-y-3 bg-white p-4 rounded-xl border">
            <div class="grid grid-cols-2 gap-3">
              <div>
                <label class="text-sm">‡πÄ‡∏•‡∏Ç‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ï‡∏±‡∏ß‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</label>
                <input name="studentId" id="studentId" required pattern="[0-9]{4}" maxlength="4" placeholder="0001-9999" class="w-full px-3 py-2 rounded-xl border" />
              </div>
              <div>
                <label class="text-sm">‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</label>
                <input name="studentName" id="studentName" required placeholder="‡∏ä‡∏∑‡πà‡∏≠-‡∏™‡∏Å‡∏∏‡∏•" class="w-full px-3 py-2 rounded-xl border" />
              </div>
            </div>

            <div>
              <label class="text-sm">‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠</label>
              <input name="title" id="title" required class="w-full px-3 py-2 rounded-xl border" />
            </div>

            <div class="grid grid-cols-2 gap-3">
              <div>
                <label class="text-sm">‡∏ú‡∏π‡πâ‡πÅ‡∏ï‡πà‡∏á</label>
                <input name="author" id="author" required class="w-full px-3 py-2 rounded-xl border" />
              </div>
              <div>
                <label class="text-sm">‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡∏î‡∏¥‡∏ß‡∏≠‡∏µ‡πâ</label>
                <select id="dewey" name="dewey" required class="w-full px-3 py-2 rounded-xl border"></select>
              </div>
            </div>

            <div class="grid grid-cols-3 gap-3">
              <div>
                <label class="text-sm">‡∏™‡∏≥‡∏ô‡∏±‡∏Å‡∏û‡∏¥‡∏°‡∏û‡πå</label>
                <input name="publisher" id="publisher" class="w-full px-3 py-2 rounded-xl border" />
              </div>
              <div>
                <label class="text-sm">‡∏õ‡∏µ‡∏ó‡∏µ‡πà‡∏û‡∏¥‡∏°‡∏û‡πå</label>
                <input name="year" id="year" inputmode="numeric" pattern="[0-9]{4}" class="w-full px-3 py-2 rounded-xl border" />
              </div>
              <div>
                <label class="text-sm">‡∏£‡∏´‡∏±‡∏™‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠</label>
                <input name="bookCode" id="bookCode" required class="w-full px-3 py-2 rounded-xl border" />
              </div>
            </div>

            <div>
              <label class="text-sm">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</label>
              <select name="type" id="type" class="w-full px-3 py-2 rounded-xl border">
                <option value="‡∏¢‡∏∑‡∏°">‡∏¢‡∏∑‡∏°</option>
                <option value="‡∏Ñ‡∏∑‡∏ô">‡∏Ñ‡∏∑‡∏ô</option>
              </select>
            </div>

            <div class="flex gap-2">
              <button type="submit" class="px-5 py-2 rounded-xl bg-emerald-600 text-white font-semibold">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏¢‡∏∑‡∏°/‡∏Ñ‡∏∑‡∏ô</button>
              <button type="reset" class="px-5 py-2 rounded-xl bg-slate-200">‡∏•‡πâ‡∏≤‡∏á‡∏ü‡∏≠‡∏£‡πå‡∏°</button>
            </div>
          </form>
        </div>
      </div>
    </section>

    <!-- Add book -->
    <section id="add" class="tab-panel hidden bg-white rounded-2xl shadow p-6 mt-4">
      <h2 class="text-xl font-bold text-blue-700">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠</h2>
      <form id="addForm" class="mt-4 space-y-3">
        <div>
          <label class="text-sm">‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠</label>
          <input name="title" id="addTitle" class="w-full px-3 py-2 rounded-xl border" required />
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div>
            <label class="text-sm">‡∏ú‡∏π‡πâ‡πÅ‡∏ï‡πà‡∏á</label>
            <input name="author" id="addAuthor" class="w-full px-3 py-2 rounded-xl border" required />
          </div>
          <div>
            <label class="text-sm">‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡∏î‡∏¥‡∏ß‡∏≠‡∏µ‡πâ</label>
            <select id="addDewey" name="dewey" class="w-full px-3 py-2 rounded-xl border" required></select>
          </div>
        </div>
        <div class="grid grid-cols-3 gap-3">
          <div>
            <label class="text-sm">‡∏™‡∏≥‡∏ô‡∏±‡∏Å‡∏û‡∏¥‡∏°‡∏û‡πå</label>
            <input id="addPublisher" name="publisher" class="w-full px-3 py-2 rounded-xl border" />
          </div>
          <div>
            <label class="text-sm">‡∏õ‡∏µ‡∏ó‡∏µ‡πà‡∏û‡∏¥‡∏°‡∏û‡πå</label>
            <input id="addYear" name="year" pattern="[0-9]{4}" class="w-full px-3 py-2 rounded-xl border" />
          </div>
          <div>
            <label class="text-sm">‡∏£‡∏´‡∏±‡∏™ISBN</label>
            <input id="addBookCode" name="BookCode" class="w-full px-3 py-2 rounded-xl border" required />
          </div>
        </div>
        <div class="flex gap-2">
          <button type="submit" class="px-4 py-2 rounded-xl bg-blue-600 text-white">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠</button>
          <button type="reset" class="px-4 py-2 rounded-xl bg-slate-200">‡∏•‡πâ‡∏≤‡∏á</button>
        </div>
      </form>
    </section>

    <!-- Gate (‡πÄ‡∏Ç‡πâ‡∏≤-‡∏≠‡∏≠‡∏Å) -->
    <section id="gate" class="tab-panel hidden bg-white rounded-2xl shadow p-6 mt-4">
      <h2 class="text-xl font-bold text-violet-700">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏Ç‡πâ‡∏≤-‡∏≠‡∏≠‡∏Å</h2>
      <form id="gateForm" class="mt-4 grid grid-cols-1 md:grid-cols-3 gap-3">
        <input id="gateStudentId" placeholder="‡πÄ‡∏•‡∏Ç‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ï‡∏±‡∏ß (0001-9999)" pattern="[0-9]{4}" class="px-3 py-2 rounded-xl border" required />
        <input id="gateStudentName" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô" class="px-3 py-2 rounded-xl border" nonrequired />
        <select id="gateType" class="px-3 py-2 rounded-xl border">
          <option value="‡πÄ‡∏Ç‡πâ‡∏≤">‡πÄ‡∏Ç‡πâ‡∏≤</option>
          <option value="‡∏≠‡∏≠‡∏Å">‡∏≠‡∏≠‡∏Å</option>
        </select>
        <div class="md:col-span-3">
          <button type="submit" class="px-4 py-2 rounded-xl bg-violet-600 text-white">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏Ç‡πâ‡∏≤/‡∏≠‡∏≠‡∏Å</button>
        </div>
      </form>
    </section>

    <!-- Assistant -->
    <section id="assistant" class="tab-panel hidden bg-white rounded-2xl shadow p-6 mt-4">
      <h2 class="text-xl font-bold text-emerald-700">‡∏ú‡∏π‡πâ‡∏ä‡πà‡∏ß‡∏¢‡∏ö‡∏£‡∏£‡∏ì‡∏≤‡∏£‡∏±‡∏Å‡∏©‡πå</h2>
      <form id="assistantForm" class="mt-4 space-y-3">
        <div class="grid grid-cols-2 gap-3">
          <input id="assistantStudentId" placeholder="‡πÄ‡∏•‡∏Ç‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ï‡∏±‡∏ß 0001-9999" pattern="[0-9]{4}" class="px-3 py-2 rounded-xl border" required />
          <input id="assistantStudentName" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô" class="px-3 py-2 rounded-xl border" required />
        </div>
        <div class="grid sm:grid-cols-2 gap-2">
          <label><input type="checkbox" name="task" value="‡∏Å‡∏ß‡∏≤‡∏î‡∏û‡∏∑‡πâ‡∏ô" /> ‡∏Å‡∏ß‡∏≤‡∏î‡∏û‡∏∑‡πâ‡∏ô</label>
          <label><input type="checkbox" name="task" value="‡∏ñ‡∏π‡∏û‡∏∑‡πâ‡∏ô" /> ‡∏ñ‡∏π‡∏û‡∏∑‡πâ‡∏ô</label>
          <label><input type="checkbox" name="task" value="‡∏à‡∏±‡∏î‡πÄ‡∏Å‡πá‡∏ö‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠" /> ‡∏à‡∏±‡∏î‡πÄ‡∏Å‡πá‡∏ö‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠</label>
          <label><input type="checkbox" name="task" value="‡πÄ‡∏ä‡πá‡∏î‡πÇ‡∏ï‡πä‡∏∞" /> ‡πÄ‡∏ä‡πá‡∏î‡πÇ‡∏ï‡πä‡∏∞</label>
          <label><input type="checkbox" name="task" value="‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏°-‡∏Ñ‡∏∑‡∏ô" /> ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏°-‡∏Ñ‡∏∑‡∏ô</label>
          <label><input type="checkbox" name="task" value="‡πÄ‡∏ä‡πá‡∏î‡∏ä‡∏±‡πâ‡∏ô‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠" /> ‡πÄ‡∏ä‡πá‡∏î‡∏ä‡∏±‡πâ‡∏ô‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠</label>
        </div>
        <div>
          <button type="submit" class="px-4 py-2 rounded-xl bg-emerald-600 text-white">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏á‡∏≤‡∏ô‡∏ú‡∏π‡πâ‡∏ä‡πà‡∏ß‡∏¢</button>
        </div>
      </form>
    </section>

    <!-- Stats area -->
    <section id="stats" class="tab-panel hidden bg-white rounded-2xl shadow p-6 mt-4">
      <h2 class="text-xl font-bold">‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥</h2>
      <div class="grid md:grid-cols-3 gap-4 mt-4">
        <div class="p-4 rounded-xl bg-emerald-50 border"><div class="text-sm text-emerald-700">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏°</div><div id="statBorrow" class="text-3xl font-bold">-</div></div>
        <div class="p-4 rounded-xl bg-blue-50 border"><div class="text-sm text-blue-700">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Å‡∏≤‡∏£‡∏Ñ‡∏∑‡∏ô</div><div id="statReturn" class="text-3xl font-bold">-</div></div>
        <div class="p-4 rounded-xl bg-violet-50 border"><div class="text-sm text-violet-700">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</div><div id="statRecent" class="text-sm">-</div></div>
      </div>
      <div class="mt-4"><button id="refreshStats" class="px-4 py-2 rounded-xl bg-slate-800 text-white">‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä</button></div>
    </section>
  </main>

  <footer class="max-w-5xl mx-auto p-4 text-center text-xs text-slate-500">‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Google Apps Script ‡∏î‡πâ‡∏ß‡∏¢ JSONP ‚Äî ‡∏ï‡πâ‡∏≠‡∏á Deploy Apps Script ‡πÄ‡∏õ‡πá‡∏ô Web App</footer>

<script>
/* ================== CONFIG ================== */
/* ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô URL Apps Script ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏ñ‡πâ‡∏≤‡πÅ‡∏ï‡∏Å‡∏ï‡πà‡∏≤‡∏á */
const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbyxF13nNkv7pFU2iyYEWtZQpPU8DZvVKOgfZ6Hgw4QEVfDZ0zqRjyyb9gbjQjzGp3BA_A/exec';

const DEWEY = [
  ['000','‡∏Ñ‡∏≠‡∏°‡∏û‡∏¥‡∏ß‡πÄ‡∏ï‡∏≠‡∏£‡πå ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ'],
  ['100','‡∏õ‡∏£‡∏±‡∏ä‡∏ç‡∏≤ ‡∏à‡∏¥‡∏ï‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤'],
  ['200','‡∏®‡∏≤‡∏™‡∏ô‡∏≤'],
  ['300','‡∏™‡∏±‡∏á‡∏Ñ‡∏°‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå'],
  ['400','‡∏†‡∏≤‡∏©‡∏≤'],
  ['500','‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå'],
  ['600','‡πÄ‡∏ó‡∏Ñ‡πÇ‡∏ô‡πÇ‡∏•‡∏¢‡∏µ'],
  ['700','‡∏®‡∏¥‡∏•‡∏õ‡∏∞ ‡∏Å‡∏µ‡∏¨‡∏≤'],
  ['800','‡∏ß‡∏£‡∏£‡∏ì‡∏Ñ‡∏î‡∏µ'],
  ['900','‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå ‡∏†‡∏π‡∏°‡∏¥‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå'],
  ['AS','‡∏≠‡∏≤‡πÄ‡∏ã‡∏µ‡∏¢‡∏ô'],
  ['BK','‡∏Å‡∏£‡∏∏‡∏á‡πÄ‡∏ó‡∏û‡∏°‡∏´‡∏≤‡∏ô‡∏Ñ‡∏£'],
  ['KQ','‡∏û‡∏£‡∏∞‡∏°‡∏´‡∏≤‡∏Å‡∏©‡∏±‡∏ï‡∏£‡∏¥‡∏¢‡πå']  
];

/* ‡πÄ‡∏ï‡∏¥‡∏° dropdown Dewey */
function fillDewey(selectId){
  const sel = document.getElementById(selectId);
  sel.innerHTML = '<option value=\"\">‚Äî ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡∏î‡∏¥‡∏ß‡∏≠‡∏µ‡πâ ‚Äî</option>';
  DEWEY.forEach(d => {
    const opt = document.createElement('option');
    opt.value = d[0] + ' ' + d[1];
    opt.textContent = d[0] + ' ‚Äî ' + d[1];
    sel.appendChild(opt);
  });
}
fillDewey('dewey');
fillDewey('addDewey');

/* Tab handling */
document.querySelectorAll('.tab-btn').forEach(btn=>{
  btn.addEventListener('click', ()=> {
    document.querySelectorAll('.tab-panel').forEach(p => p.classList.add('hidden'));
    document.getElementById(btn.dataset.tab).classList.remove('hidden');
  });
});
/* show loan by default */
document.getElementById('loan').classList.remove('hidden');

/* ================== JSONP helper ================== */
function jsonpRequest(params){
  return new Promise((resolve,reject)=>{
    const cbName = 'cb_' + Math.random().toString(36).slice(2);
    window[cbName] = (data) => { resolve(data); cleanup(); };
    const query = new URLSearchParams({...params, callback: cbName}).toString();
    const s = document.createElement('script');
    s.src = SCRIPT_URL + '?' + query;
    s.onerror = () => { reject(new Error('JSONP load error')); cleanup(); };
    document.body.appendChild(s);
    function cleanup(){ delete window[cbName]; s.remove(); }
  });
}

/* ================== QR scanner + camera switch ================== */
let html5QrCode = null;
let cameras = [];
let currentCameraIndex = 0;
let isScanning = false;

async function listCameras(){
  try{
    cameras = await Html5Qrcode.getCameras();
    const div = document.getElementById('cameraList');
    if(!cameras || cameras.length === 0){ div.textContent = '‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Å‡∏•‡πâ‡∏≠‡∏á'; return; }
    // show labels small
    div.innerHTML = cameras.map((c,i)=>`<div class="text-xs">${i+1}. ${c.label || c.id}</div>`).join('');
    // pick a rear camera if possible
    const rear = cameras.findIndex(c => /back|rear|environment/i.test(c.label || ''));
    currentCameraIndex = rear >= 0 ? rear : 0;
  }catch(e){
    document.getElementById('cameraList').textContent = '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏î‡∏∂‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Å‡∏•‡πâ‡∏≠‡∏á‡πÑ‡∏î‡πâ';
  }
}

async function startQr(){
  await listCameras();
  startScanner(currentCameraIndex);
}

async function startScanner(index){
  if(!cameras || !cameras.length) await listCameras();
  if(!cameras || !cameras.length){ Swal.fire('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Å‡∏•‡πâ‡∏≠‡∏á','‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏•‡πâ‡∏≠‡∏á‡∏´‡∏£‡∏∑‡∏≠‡∏£‡∏∞‡∏ö‡∏ö‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï','error'); return; }
  const deviceId = cameras[index].id;
  if(html5QrCode){
    try{ await html5QrCode.stop(); html5QrCode.clear(); }catch(e){}
    html5QrCode = null;
  }
  html5QrCode = new Html5Qrcode('qr-region');
  isScanning = false;
  try{
    await html5QrCode.start(
      { deviceId: { exact: deviceId } },
      { fps: 10, qrbox: { width: 300, height: 200 } }, // ‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡πÄ‡∏ü‡∏£‡∏° (‡∏™‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏µ‡πà‡∏¢‡∏°‡∏ú‡∏∑‡∏ô‡∏ú‡πâ‡∏≤)
      (decodedText, decodedResult) => {
        // ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô trigger ‡∏ã‡πâ‡∏≥ ‡πÜ
        if(isScanning) return;
        isScanning = true;
        // ‡πÄ‡∏ï‡∏¥‡∏°‡∏£‡∏´‡∏±‡∏™‡∏•‡∏á‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÅ‡∏•‡∏∞‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
        document.getElementById('bookCode').value = decodedText.trim();
        fetchBookByCode(decodedText.trim()).finally(()=> {
          // ‡πÄ‡∏£‡∏≤‡∏õ‡∏¥‡∏î‡∏Å‡∏•‡πâ‡∏≠‡∏á‡∏ó‡∏±‡∏ô‡∏ó‡∏µ‡∏´‡∏•‡∏±‡∏á‡∏™‡πÅ‡∏Å‡∏ô‡πÄ‡∏™‡∏£‡πá‡∏à
          if(html5QrCode) html5QrCode.stop().catch(()=>{});
        });
      },
      (errorMessage) => { /* ignore minor scan errors */ }
    );
    Swal.fire({ icon:'info', title: '‡πÄ‡∏õ‡∏¥‡∏î‡∏Å‡∏•‡πâ‡∏≠‡∏á‡πÅ‡∏•‡πâ‡∏ß', timer:700, showConfirmButton:false });
  }catch(err){
    Swal.fire('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏õ‡∏¥‡∏î‡∏Å‡∏•‡πâ‡∏≠‡∏á', err.message || err, 'error');
  }
}

document.getElementById('btnStartQR').addEventListener('click', startQr);
document.getElementById('btnStopQR').addEventListener('click', ()=>{
  if(html5QrCode){ html5QrCode.stop().catch(()=>{}); html5QrCode.clear(); html5QrCode = null; Swal.fire({ icon:'info', title:'‡∏õ‡∏¥‡∏î‡∏Å‡∏•‡πâ‡∏≠‡∏á', timer:700, showConfirmButton:false }); }
});
document.getElementById('btnSwitchCam').addEventListener('click', async ()=>{
  if(!cameras || cameras.length===0) await listCameras();
  if(!cameras || cameras.length===0) return Swal.fire('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Å‡∏•‡πâ‡∏≠‡∏á‡πÉ‡∏´‡πâ‡∏™‡∏•‡∏±‡∏ö','‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏°‡∏µ‡πÅ‡∏Ñ‡πà‡∏ô‡πâ‡∏≠‡∏¢‡∏Å‡∏ß‡πà‡∏≤ 2 ‡∏Å‡∏•‡πâ‡∏≠‡∏á','error');
  currentCameraIndex = (currentCameraIndex + 1) % cameras.length;
  startScanner(currentCameraIndex);
});

/* ================== Fetch book by code (manual or QR) ================== */
async function fetchBookByCode(code){
  if(!code){ Swal.fire('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠','‡∏£‡∏´‡∏±‡∏™‡∏ß‡πà‡∏≤‡∏á','warning'); isScanning=false; return; }
  Swal.fire({ title:'‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤...', didOpen: ()=> Swal.showLoading(), allowOutsideClick:false });
  try{
    const res = await jsonpRequest({ action:'getBookByCode', sheet: '‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠', code });
    Swal.close();
    if(res?.ok && res.book){
      // map values from columns B..G
      document.getElementById('title').value = res.book.title || '';
      document.getElementById('author').value = res.book.author || '';
      // set dewey, if not present add option
      const deweyVal = res.book.dewey || '';
      const sel = document.getElementById('dewey');
      if(deweyVal){
        let found = Array.from(sel.options).some(o => o.value === deweyVal);
        if(!found){ const opt = document.createElement('option'); opt.value=deweyVal; opt.textContent = deweyVal; sel.appendChild(opt); }
        sel.value = deweyVal;
      }
      document.getElementById('publisher').value = res.book.publisher || '';
      document.getElementById('year').value = res.book.year || '';
      document.getElementById('bookCode').value = res.book.bookCode || code;
      Swal.fire({ icon:'success', title:'‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢', timer:1200, showConfirmButton:false });
    } else {
      Swal.fire('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠', res?.message || '‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÉ‡∏ô‡∏ä‡∏µ‡∏ï ‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠', 'error');
    }
  }catch(err){
    Swal.close();
    Swal.fire('‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î','‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö Apps Script ‡πÑ‡∏î‡πâ', 'error');
  } finally {
    isScanning = false;
  }
}
document.getElementById('btnLookupCode').addEventListener('click', ()=> fetchBookByCode(document.getElementById('manualCode').value.trim()));

/* ================== Submit forms (JSONP) ================== */
/* 1) ‡∏¢‡∏∑‡∏°-‡∏Ñ‡∏∑‡∏ô -> ‡∏ä‡∏µ‡∏ï '‡∏¢‡∏∑‡∏°-‡∏Ñ‡∏∑‡∏ô' ‡∏ï‡∏≤‡∏°‡∏´‡∏±‡∏ß‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î */
document.getElementById('loanForm').addEventListener('submit', async (e)=>{
  e.preventDefault();
  const payload = {
    action:'addBorrowReturn', sheet: '‡∏¢‡∏∑‡∏°-‡∏Ñ‡∏∑‡∏ô',
    studentId: document.getElementById('studentId').value.trim(),
    studentName: document.getElementById('studentName').value.trim(),
    title: document.getElementById('title').value.trim(),
    author: document.getElementById('author').value.trim(),
    dewey: document.getElementById('dewey').value.trim(),
    publisher: document.getElementById('publisher').value.trim(),
    year: document.getElementById('year').value.trim(),
    bookCode: document.getElementById('bookCode').value.trim(),
    type: document.getElementById('type').value
  };
  Swal.fire({ title:'‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å...', didOpen: ()=> Swal.showLoading(), allowOutsideClick:false });
  try{
    const res = await jsonpRequest(payload);
    Swal.close();
    if(res?.ok){ Swal.fire({ icon:'success', title:'‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', timer:1200, showConfirmButton:false }); e.target.reset(); }
    else Swal.fire('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', res?.message || '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', 'error');
  }catch(err){
    Swal.close();
    Swal.fire('‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î','‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏õ‡∏¢‡∏±‡∏á Apps Script ‡πÑ‡∏î‡πâ', 'error');
  }
});

/* 2) ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠ -> ‡∏ä‡∏µ‡∏ï '‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠' */
document.getElementById('addForm').addEventListener('submit', async (e)=>{
  e.preventDefault();
  const payload = {
    action:'addBook', sheet:'‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠',
    title: document.getElementById('addTitle').value.trim(),
    author: document.getElementById('addAuthor').value.trim(),
    dewey: document.getElementById('addDewey').value.trim(),
    publisher: document.getElementById('addPublisher').value.trim(),
    year: document.getElementById('addYear').value.trim(),
    bookCode: document.getElementById('addBookCode').value.trim()
  };
  Swal.fire({ title:'‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠...', didOpen: ()=> Swal.showLoading(), allowOutsideClick:false });
  try{
    const res = await jsonpRequest(payload);
    Swal.close();
    if(res?.ok){ Swal.fire({ icon:'success', title:'‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', timer:1200, showConfirmButton:false }); e.target.reset(); }
    else Swal.fire('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', res?.message || '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', 'error');
  }catch(err){
    Swal.close();
    Swal.fire('‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡πÑ‡∏î‡πâ', 'error');
  }
});

/* 3) ‡πÄ‡∏Ç‡πâ‡∏≤-‡∏≠‡∏≠‡∏Å -> ‡∏ä‡∏µ‡∏ï '‡πÄ‡∏Ç‡πâ‡∏≤-‡∏≠‡∏≠‡∏Å' */
document.getElementById('gateForm').addEventListener('submit', async (e)=>{
  e.preventDefault();
  const payload = {
    action:'addGate', sheet:'‡πÄ‡∏Ç‡πâ‡∏≤-‡∏≠‡∏≠‡∏Å',
    studentId: document.getElementById('gateStudentId').value.trim(),
    studentName: document.getElementById('gateStudentName').value.trim(),
    type: document.getElementById('gateType').value
  };
  Swal.fire({ title:'‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å...', didOpen: ()=> Swal.showLoading(), allowOutsideClick:false });
  try{
    const res = await jsonpRequest(payload);
    Swal.close();
    if(res?.ok){ Swal.fire({ icon:'success', title:'‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏Ç‡πâ‡∏≤-‡∏≠‡∏≠‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', timer:1100, showConfirmButton:false }); e.target.reset(); }
    else Swal.fire('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', res?.message || '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', 'error');
  }catch(err){
    Swal.close();
    Swal.fire('‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î','‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ', 'error');
  }
});

/* 4) ‡∏ú‡∏π‡πâ‡∏ä‡πà‡∏ß‡∏¢ -> ‡∏ä‡∏µ‡∏ï '‡∏ú‡∏π‡πâ‡∏ä‡πà‡∏ß‡∏¢' */
document.getElementById('assistantForm').addEventListener('submit', async (e)=>{
  e.preventDefault();
  const tasks = Array.from(document.querySelectorAll('input[name="task"]:checked')).map(i=>i.value);
  if(tasks.length === 0){ Swal.fire('‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏á‡∏≤‡∏ô‡∏î‡πâ‡∏ß‡∏¢','‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1 ‡∏á‡∏≤‡∏ô','warning'); return; }
  const payload = {
    action:'addAssistant', sheet:'‡∏ú‡∏π‡πâ‡∏ä‡πà‡∏ß‡∏¢',
    studentId: document.getElementById('assistantStudentId').value.trim(),
    studentName: document.getElementById('assistantStudentName').value.trim(),
    tasks: tasks.join(', ')
  };
  Swal.fire({ title:'‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏á‡∏≤‡∏ô‡∏ú‡∏π‡πâ‡∏ä‡πà‡∏ß‡∏¢...', didOpen: ()=> Swal.showLoading(), allowOutsideClick:false });
  try{
    const res = await jsonpRequest(payload);
    Swal.close();
    if(res?.ok){ Swal.fire({ icon:'success', title:'‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏á‡∏≤‡∏ô‡∏ú‡∏π‡πâ‡∏ä‡πà‡∏ß‡∏¢‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', timer:1100, showConfirmButton:false }); e.target.reset(); }
    else Swal.fire('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', res?.message || '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', 'error');
  }catch(err){
    Swal.close();
    Swal.fire('‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î','‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ú‡∏π‡πâ‡∏ä‡πà‡∏ß‡∏¢‡πÑ‡∏î‡πâ', 'error');
  }
});

/* Stats */
document.getElementById('refreshStats').addEventListener('click', async ()=>{
  Swal.fire({ title:'‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏∂‡∏á‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥...', didOpen: ()=> Swal.showLoading(), allowOutsideClick:false });
  try{
    const res = await jsonpRequest({ action:'getStats', sheet:'‡∏¢‡∏∑‡∏°-‡∏Ñ‡∏∑‡∏ô' });
    Swal.close();
    if(res?.ok){
      document.getElementById('statBorrow').textContent = res.borrow || 0;
      document.getElementById('statReturn').textContent = res.return || 0;
      document.getElementById('statRecent').innerHTML = (res.recent || []).map(r=>`<div>‚Ä¢ ${r}</div>`).join('') || '-';
      Swal.fire({ icon:'success', title:'‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡πÅ‡∏•‡πâ‡∏ß', timer:900, showConfirmButton:false });
    } else Swal.fire('‡∏î‡∏∂‡∏á‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', res?.message || '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', 'error');
  }catch(e){
    Swal.close();
    Swal.fire('‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î','‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏î‡∏∂‡∏á‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡πÑ‡∏î‡πâ', 'error');
  }
});

/* initial camera list (try silently) */
Html5Qrcode.getCameras().then(devs=>{ if(devs && devs.length) cameras = devs; }).catch(()=>{});
</script>
</body>
</html>

<!DOCTYPE html><html lang="th">
<head>
  <meta charset="UTF-8">
  <title>‡∏´‡πâ‡∏≠‡∏á‡∏™‡∏°‡∏∏‡∏î‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
  <script src="https://unpkg.com/html5-qrcode"></script>
</head>
<body class="bg-gradient-to-r from-green-200 via-blue-200 to-purple-200 min-h-screen p-6">
  <div class="max-w-5xl mx-auto bg-white rounded-2xl shadow-xl p-6">
    <h1 class="text-3xl font-bold text-center text-purple-700 mb-6">üìö ‡∏£‡∏∞‡∏ö‡∏ö‡∏´‡πâ‡∏≠‡∏á‡∏™‡∏°‡∏∏‡∏î‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</h1><div class="grid grid-cols-1 md:grid-cols-2 gap-6">
  <button onclick="showSection('borrowReturn')" class="p-4 bg-green-500 text-white rounded-xl shadow hover:bg-green-600">‡∏¢‡∏∑‡∏°-‡∏Ñ‡∏∑‡∏ô ‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠</button>
  <button onclick="showSection('addBook')" class="p-4 bg-blue-500 text-white rounded-xl shadow hover:bg-blue-600">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠</button>
  <button onclick="showSection('entryExit')" class="p-4 bg-purple-500 text-white rounded-xl shadow hover:bg-purple-600">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏Ç‡πâ‡∏≤-‡∏≠‡∏≠‡∏Å ‡∏´‡πâ‡∏≠‡∏á‡∏™‡∏°‡∏∏‡∏î</button>
  <button onclick="showSection('assistant')" class="p-4 bg-pink-500 text-white rounded-xl shadow hover:bg-pink-600">‡∏ú‡∏π‡πâ‡∏ä‡πà‡∏ß‡∏¢‡∏ö‡∏£‡∏£‡∏ì‡∏≤‡∏£‡∏±‡∏Å‡∏©‡πå</button>
</div>

<!-- ‡∏¢‡∏∑‡∏°-‡∏Ñ‡∏∑‡∏ô ‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠ -->
<div id="borrowReturn" class="hidden mt-6">
  <h2 class="text-2xl font-semibold text-green-700 mb-4">üìñ ‡∏¢‡∏∑‡∏°-‡∏Ñ‡∏∑‡∏ô ‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠</h2>
  <div id="qr-reader" class="w-full h-64 border rounded-xl mb-4"></div>
  <button onclick="startScanner(selectedCamera)" class="px-4 py-2 bg-indigo-500 text-white rounded-xl">‡πÄ‡∏õ‡∏¥‡∏î‡∏Å‡∏•‡πâ‡∏≠‡∏á</button>
  <button onclick="switchCamera()" class="px-4 py-2 bg-gray-500 text-white rounded-xl ml-2">‡∏™‡∏•‡∏±‡∏ö‡∏Å‡∏•‡πâ‡∏≠‡∏á</button>
  <form id="borrowReturnForm" class="mt-4 space-y-2">
    <input id="studentId" placeholder="‡πÄ‡∏•‡∏Ç‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ï‡∏±‡∏ß‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô" class="w-full p-2 border rounded" required>
    <input id="studentName" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô" class="w-full p-2 border rounded" required>
    <input id="bookTitle" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠" class="w-full p-2 border rounded" required>
    <input id="bookAuthor" placeholder="‡∏ú‡∏π‡πâ‡πÅ‡∏ï‡πà‡∏á" class="w-full p-2 border rounded" required>
    <select id="bookDewey" class="w-full p-2 border rounded">
      <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡∏î‡∏¥‡∏ß‡∏≠‡∏µ‡πâ</option>
      <option>000 ‚Äì ‡πÄ‡∏ö‡πá‡∏î‡πÄ‡∏ï‡∏•‡πá‡∏î</option>
      <option>100 ‚Äì ‡∏õ‡∏£‡∏±‡∏ä‡∏ç‡∏≤</option>
      <option>200 ‚Äì ‡∏®‡∏≤‡∏™‡∏ô‡∏≤</option>
      <option>300 ‚Äì ‡∏™‡∏±‡∏á‡∏Ñ‡∏°‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå</option>
      <option>400 ‚Äì ‡∏†‡∏≤‡∏©‡∏≤</option>
      <option>500 ‚Äì ‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå</option>
      <option>600 ‚Äì ‡πÄ‡∏ó‡∏Ñ‡πÇ‡∏ô‡πÇ‡∏•‡∏¢‡∏µ</option>
      <option>700 ‚Äì ‡∏®‡∏¥‡∏•‡∏õ‡∏∞‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡πÄ‡∏ó‡∏¥‡∏á</option>
      <option>800 ‚Äì ‡∏ß‡∏£‡∏£‡∏ì‡∏Ñ‡∏î‡∏µ</option>
      <option>900 ‚Äì ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå‡πÅ‡∏•‡∏∞‡∏†‡∏π‡∏°‡∏¥‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå</option>
    </select>
    <input id="bookPublisher" placeholder="‡∏™‡∏≥‡∏ô‡∏±‡∏Å‡∏û‡∏¥‡∏°‡∏û‡πå" class="w-full p-2 border rounded">
    <input id="bookYear" placeholder="‡∏õ‡∏µ‡∏ó‡∏µ‡πà‡∏û‡∏¥‡∏°‡∏û‡πå" class="w-full p-2 border rounded">
    <input id="bookCode" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠" class="w-full p-2 border rounded" required>
    <select id="transactionType" class="w-full p-2 border rounded" required>
      <option value="‡∏¢‡∏∑‡∏°">‡∏¢‡∏∑‡∏°</option>
      <option value="‡∏Ñ‡∏∑‡∏ô">‡∏Ñ‡∏∑‡∏ô</option>
    </select>
    <button type="submit" class="px-4 py-2 bg-green-600 text-white rounded-xl">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
  </form>
</div>

<!-- ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠ -->
<div id="addBook" class="hidden mt-6">
  <h2 class="text-2xl font-semibold text-blue-700 mb-4">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠</h2>
  <form id="addBookForm" class="space-y-2">
    <input id="addTitle" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠" class="w-full p-2 border rounded" required>
    <input id="addAuthor" placeholder="‡∏ú‡∏π‡πâ‡πÅ‡∏ï‡πà‡∏á" class="w-full p-2 border rounded" required>
    <select id="addDewey" class="w-full p-2 border rounded">
      <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡∏î‡∏¥‡∏ß‡∏≠‡∏µ‡πâ</option>
      <option>000 ‚Äì ‡πÄ‡∏ö‡πá‡∏î‡πÄ‡∏ï‡∏•‡πá‡∏î</option>
      <option>100 ‚Äì ‡∏õ‡∏£‡∏±‡∏ä‡∏ç‡∏≤</option>
      <option>200 ‚Äì ‡∏®‡∏≤‡∏™‡∏ô‡∏≤</option>
      <option>300 ‚Äì ‡∏™‡∏±‡∏á‡∏Ñ‡∏°‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå</option>
      <option>400 ‚Äì ‡∏†‡∏≤‡∏©‡∏≤</option>
      <option>500 ‚Äì ‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå</option>
      <option>600 ‚Äì ‡πÄ‡∏ó‡∏Ñ‡πÇ‡∏ô‡πÇ‡∏•‡∏¢‡∏µ</option>
      <option>700 ‚Äì ‡∏®‡∏¥‡∏•‡∏õ‡∏∞‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡πÄ‡∏ó‡∏¥‡∏á</option>
      <option>800 ‚Äì ‡∏ß‡∏£‡∏£‡∏ì‡∏Ñ‡∏î‡∏µ</option>
      <option>900 ‚Äì ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå‡πÅ‡∏•‡∏∞‡∏†‡∏π‡∏°‡∏¥‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå</option>
    </select>
    <input id="addPublisher" placeholder="‡∏™‡∏≥‡∏ô‡∏±‡∏Å‡∏û‡∏¥‡∏°‡∏û‡πå" class="w-full p-2 border rounded">
    <input id="addYear" placeholder="‡∏õ‡∏µ‡∏ó‡∏µ‡πà‡∏û‡∏¥‡∏°‡∏û‡πå" class="w-full p-2 border rounded">
    <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded-xl">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
  </form>
</div>

<!-- ‡πÄ‡∏Ç‡πâ‡∏≤-‡∏≠‡∏≠‡∏Å ‡∏´‡πâ‡∏≠‡∏á‡∏™‡∏°‡∏∏‡∏î -->
<div id="entryExit" class="hidden mt-6">
  <h2 class="text-2xl font-semibold text-purple-700 mb-4">üö™ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏Ç‡πâ‡∏≤-‡∏≠‡∏≠‡∏Å ‡∏´‡πâ‡∏≠‡∏á‡∏™‡∏°‡∏∏‡∏î</h2>
  <form id="entryExitForm" class="space-y-2">
    <input id="entryStudentId" placeholder="‡πÄ‡∏•‡∏Ç‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ï‡∏±‡∏ß‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô" class="w-full p-2 border rounded" required>
    <input id="entryStudentName" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô" class="w-full p-2 border rounded" required>
    <select id="entryType" class="w-full p-2 border rounded" required>
      <option value="‡πÄ‡∏Ç‡πâ‡∏≤">‡πÄ‡∏Ç‡πâ‡∏≤</option>
      <option value="‡∏≠‡∏≠‡∏Å">‡∏≠‡∏≠‡∏Å</option>
    </select>
    <button type="submit" class="px-4 py-2 bg-purple-600 text-white rounded-xl">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
  </form>
</div>

<!-- ‡∏ú‡∏π‡πâ‡∏ä‡πà‡∏ß‡∏¢‡∏ö‡∏£‡∏£‡∏ì‡∏≤‡∏£‡∏±‡∏Å‡∏©‡πå -->
<div id="assistant" class="hidden mt-6">
  <h2 class="text-2xl font-semibold text-pink-700 mb-4">üôã ‡∏ú‡∏π‡πâ‡∏ä‡πà‡∏ß‡∏¢‡∏ö‡∏£‡∏£‡∏ì‡∏≤‡∏£‡∏±‡∏Å‡∏©‡πå</h2>
  <form id="assistantForm" class="space-y-2">
    <input id="assistantName" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏ä‡πà‡∏ß‡∏¢" class="w-full p-2 border rounded" required>
    <select id="assistantTask" class="w-full p-2 border rounded" required>
      <option>‡∏Å‡∏ß‡∏≤‡∏î‡∏û‡∏∑‡πâ‡∏ô</option>
      <option>‡∏ñ‡∏π‡∏û‡∏∑‡πâ‡∏ô</option>
      <option>‡∏à‡∏±‡∏î‡πÄ‡∏Å‡πá‡∏ö‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠</option>
      <option>‡πÄ‡∏ä‡πá‡∏î‡πÇ‡∏ï‡πä‡∏∞</option>
      <option>‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏°-‡∏Ñ‡∏∑‡∏ô‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠</option>
      <option>‡πÄ‡∏ä‡πá‡∏î‡∏ä‡∏±‡πâ‡∏ô‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠</option>
    </select>
    <button type="submit" class="px-4 py-2 bg-pink-600 text-white rounded-xl">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
  </form>
</div>

  </div>  <script>
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbyxF13nNkv7pFU2iyYEWtZQpPU8DZvVKOgfZ6Hgw4QEVfDZ0zqRjyyb9gbjQjzGp3BA_A/exec";
    let html5QrCode;
    let cameras = [];
    let selectedCamera;
    let isScanning = false;

    function showSection(id) {
      document.querySelectorAll('#borrowReturn, #addBook, #entryExit, #assistant').forEach(el => el.classList.add('hidden'));
      document.getElementById(id).classList.remove('hidden');
    }

    function startScanner(cameraId) {
      if (html5QrCode) {
        html5QrCode.stop().catch(()=>{});
      }
      html5QrCode = new Html5QrCode("qr-reader");
      isScanning = false;
      html5QrCode.start(
        cameraId,
        { fps: 10, qrbox: { width: 300, height: 200 } },
        (decodedText) => {
          if (isScanning) return;
          isScanning = true;
          fetchBookByCode(decodedText);
          html5QrCode.stop().catch(()=>{});
        },
        (errorMessage) => {}
      );
    }

    function switchCamera() {
      Html5Qrcode.getCameras().then(devices => {
        if (devices.length > 1) {
          selectedCamera = (selectedCamera === devices[0].id) ? devices[1].id : devices[0].id;
          startScanner(selectedCamera);
        }
      });
    }

    function fetchBookByCode(code) {
      swal({ title: "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤...", buttons: false, closeOnClickOutside: false });
      const url = SCRIPT_URL + "?action=getBookByCode&code=" + encodeURIComponent(code) + "&callback=?";
      $.getJSON(url, (res) => {
        swal.close();
        if (res.ok && res.book) {
          $("#bookTitle").val(res.book.title);
          $("#bookAuthor").val(res.book.author);
          $("#bookDewey").val(res.book.dewey);
          $("#bookPublisher").val(res.book.publisher);
          $("#bookYear").val(res.book.year);
          $("#bookCode").val(res.book.bookCode);
          swal("‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à", "‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢", "success");
        } else {
          swal("‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•", res.message || "‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö", "error");
        }
        isScanning = false;
      });
    }

    // ‡πÇ‡∏´‡∏•‡∏î‡∏Å‡∏•‡πâ‡∏≠‡∏á
    Html5Qrcode.getCameras().then(devices => {
      if (devices && devices.length) {
        cameras = devices;
        selectedCamera = devices[0].id;
      }
    });

    // ‡∏ü‡∏≠‡∏£‡πå‡∏° ‡∏¢‡∏∑‡∏°-‡∏Ñ‡∏∑‡∏ô
    $("#borrowReturnForm").submit(function(e){
      e.preventDefault();
      const data = {
        action: "borrowReturn",
        studentId: $("#studentId").val(),
        studentName: $("#studentName").val(),
        bookTitle: $("#bookTitle").val(),
        bookAuthor: $("#bookAuthor").val(),
        bookDewey: $("#bookDewey").val(),
        bookPublisher: $("#bookPublisher").val(),
        bookYear: $("#bookYear").val(),
        bookCode: $("#bookCode").val(),
        transactionType: $("#transactionType").val()
      };
      swal({ title:"‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å...", buttons: false });
      $.ajax({
        url: SCRIPT_URL,
        dataType: "jsonp",
        data: data,
        success: function(){ swal("‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à","‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢","success"); }
      });
    });

    // ‡∏ü‡∏≠‡∏£‡πå‡∏° ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠
    $("#addBookForm").submit(function(e){
      e.preventDefault();
      const data = {
        action: "addBook",
        title: $("#addTitle").val(),
        author: $("#addAuthor").val(),
        dewey: $("#addDewey").val(),
        publisher: $("#addPublisher").val(),
        year: $("#addYear").val()
      };
      swal({ title:"‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å...", buttons: false });
      $.ajax({
        url: SCRIPT_URL,
        dataType: "jsonp",
        data: data,
        success: function(){ swal("‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à","‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢","success"); }
      });
    });

    // ‡∏ü‡∏≠‡∏£‡πå‡∏° ‡πÄ‡∏Ç‡πâ‡∏≤-‡∏≠‡∏≠‡∏Å ‡∏´‡πâ‡∏≠‡∏á‡∏™‡∏°‡∏∏‡∏î
    $("#entryExitForm").submit(function(e){
      e.preventDefault();
      const data = {
        action: "entryExit",
        studentId: $("#entryStudentId").val(),
        studentName: $("#entryStudentName").val(),
        entryType: $("#entryType").val()
      };
      swal({ title:"‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å...", buttons: false });
      $.ajax({
        url: SCRIPT_URL,
        dataType: "jsonp",
        data: data,
        success: function(){ swal("‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à","‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤-‡∏≠‡∏≠‡∏Å‡πÅ‡∏•‡πâ‡∏ß","success"); }
      });
    });

    // ‡∏ü‡∏≠‡∏£‡πå‡∏° ‡∏ú‡∏π‡πâ‡∏ä‡πà‡∏ß‡∏¢‡∏ö‡∏£‡∏£‡∏ì‡∏≤‡∏£‡∏±‡∏Å‡∏©‡πå
    $("#assistantForm").submit(function(e){
      e.preventDefault();
      const data = {
        action: "assistant",
        name: $("#assistantName").val(),
        task: $("#assistantTask").val()
      };
      swal({ title:"‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å...", buttons: false });
      $.ajax({
        url: SCRIPT_URL,
        dataType: "jsonp",
        data: data,
        success: function(){ swal("‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à","‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡∏ä‡πà‡∏ß‡∏¢‡πÅ‡∏•‡πâ‡∏ß","success"); }
      });
    });
  </script></body>
</html>
